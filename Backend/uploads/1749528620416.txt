CREATE TYPE project_status AS ENUM ('pendiente', 'aprobado', 'rechazado');
CREATE TYPE audit_action AS ENUM ('crear', 'eliminar', 'editar', 'archivo_agregado', 'archivo_eliminado');


CREATE TABLE "FPM_Usuari" (
  "Usua_Id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "Usua_PrimN" varchar(30),
  "Usua_PrimA" varchar(30),
  "Usua_NomUs" varchar(15) UNIQUE,
  "Usua_Email" varchar(30) UNIQUE,
  "Usua_Contr" varchar(255),
  "Usua_RolId" int,
  "Usua_FecCr" TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE "FPM_Rol" (
  "Rol_Id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "Rol_Nombre" varchar(30)
);

CREATE TABLE "FPM_Permis" (
  "Perm_Id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "Perm_Nombr" varchar(30)
);

CREATE TABLE "FPM_Catego" (
  "Cate_Id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "Cate_NomCa" varchar(50),
  "Cate_Descr" text
);

CREATE TABLE "FPT_Proyec" (
  "Proy_Id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "Proy_Titul" varchar(50),
  "Proy_Descr" text,
  "Proy_Resum" text,
  "Proy_FecRe" TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  "proy_statu" project_status,
  "Proy_UsuId" int,
  "Proy_CatId" int
);

CREATE TABLE "FPT_ProAce" (
  "ProyA_Id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "ProyA_PrId" int,
  "ProyA_FecA" date,
  "ProyA_MotA" text,
  "ProyA_Come" text
);

CREATE TABLE "FPD_Tarchi" (
  "TipA_Id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "TipA_Nombr" VARCHAR(20) UNIQUE
);


CREATE TABLE "FPD_Docume" (
  "Doc_Id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "Doc_ProyId" int,
  "Doc_NomArc" varchar(30),
  "Doc_RutaAr" text,
  "Doc_TiArId" int,
  "Doc_FecSub" TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE "FPD_Report" (
  "Rep_Id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "Rep_ProyId" int,
  "Rep_UsuaId" int,
  "Rep_Report" text,
  "Rep_FecRep" TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE "FPD_Califi" (
  "Cal_Id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "Cal_ProyId" int,
  "Cal_UsuaId" int,
  "Cal_Puntaj" INT CHECK ("Cal_Puntaj" BETWEEN 0 AND 100),
  "Cal_Coment" text,
  "Cal_FecCal" TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE "FPR_RolPer" (
  "RolP_Id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "RolP_RolId" int,
  "RolP_PerId" int
);

CREATE TABLE "FPA_Audito" (
  "Audi_Id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "Audi_PryId" int,
  "Audi_UsuId" int,
  "Audi_Accio" audit_action,
  "Audi_Descr" text,
  "Audi_FecAc" TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

ALTER TABLE "FPD_Docume" ADD FOREIGN KEY ("Doc_TiArId") REFERENCES "FPD_Tarchi"("TipA_Id");
ALTER TABLE "FPT_Proyec" ADD FOREIGN KEY ("Proy_UsuId") REFERENCES "FPM_Usuari" ("Usua_Id");
ALTER TABLE "FPD_Report" ADD FOREIGN KEY ("Rep_UsuaId") REFERENCES "FPM_Usuari" ("Usua_Id");
ALTER TABLE "FPD_Califi" ADD FOREIGN KEY ("Cal_UsuaId") REFERENCES "FPM_Usuari" ("Usua_Id");
ALTER TABLE "FPM_Usuari" ADD FOREIGN KEY ("Usua_RolId") REFERENCES "FPM_Rol" ("Rol_Id");
ALTER TABLE "FPA_Audito" ADD FOREIGN KEY ("Audi_UsuId") REFERENCES "FPM_Usuari" ("Usua_Id");
ALTER TABLE "FPR_RolPer" ADD FOREIGN KEY ("RolP_RolId") REFERENCES "FPM_Rol" ("Rol_Id");
ALTER TABLE "FPR_RolPer" ADD FOREIGN KEY ("RolP_PerId") REFERENCES "FPM_Permis" ("Perm_Id");
ALTER TABLE "FPD_Docume" ADD FOREIGN KEY ("Doc_ProyId") REFERENCES "FPT_Proyec" ("Proy_Id");
ALTER TABLE "FPT_Proyec" ADD FOREIGN KEY ("Proy_CatId") REFERENCES "FPM_Catego" ("Cate_Id");
ALTER TABLE "FPD_Report" ADD FOREIGN KEY ("Rep_ProyId") REFERENCES "FPT_Proyec" ("Proy_Id");
ALTER TABLE "FPD_Califi" ADD FOREIGN KEY ("Cal_ProyId") REFERENCES "FPT_Proyec" ("Proy_Id");
ALTER TABLE "FPA_Audito" ADD FOREIGN KEY ("Audi_PryId") REFERENCES "FPT_Proyec" ("Proy_Id");
ALTER TABLE "FPT_ProAce" ADD FOREIGN KEY ("ProyA_PrId") REFERENCES "FPT_Proyec" ("Proy_Id");